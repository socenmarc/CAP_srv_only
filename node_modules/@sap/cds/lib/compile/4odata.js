const cdsc = require ('./_cdsc'), {_options} = cdsc


function cds_compile_for_odata (csn,o) {
  if (_is_odata(csn))  return csn
  let {_4odata} = csn; if (!_4odata) {
    _4odata = cdsc.for.odata (csn, o = _options(o,'4odata'))
    // cache result for subsequent uses
    Object.defineProperty (csn, '_4odata', { value: _4odata, configurable:1, writable:1 })
    // preserve ._sources
    Object.defineProperty (_4odata, '_sources', { value: csn._sources })
    // compatibility with csn.json for old Java stack
    if (o.sql_mapping) _4odata['@sql_mapping'] = o.sql_mapping
  }
  return _4odata
}


const _is_odata = csn => csn.meta && csn.meta.transformation === 'odata'
module.exports = cds_compile_for_odata
