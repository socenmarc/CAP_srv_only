const {
  Components: { DATA_CREATE_HANDLER, DATA_DELETE_HANDLER, DATA_READ_HANDLER, DATA_UPDATE_HANDLER }
} = require('../okra/odata-server')

const boundToCQN = require('./boundToCQN')
const readToCQN = require('./readToCQN')
const updateToCQN = require('./updateToCQN')
const createToCQN = require('./createToCQN')
const deleteToCQN = require('./deleteToCQN')

/**
 * This method transforms an odata request into a CQN object.
 *
 * @param {string} component - Component name
 * @param {Object} service - Service, which will process this request
 * @param {Object} target - The target entity
 * @param {Object|Array} data - A copy of the request payload
 * @param {Object} odataReq - OKRA's req
 * @param {boolean} upsert - CREATE on PUT/PATCH
 * @returns {Object} - The CQN object
 */
module.exports = (component, service, target, data, odataReq, upsert) => {
  switch (component) {
    case DATA_CREATE_HANDLER:
      return createToCQN(target, data, odataReq, upsert)
    case DATA_DELETE_HANDLER:
      return deleteToCQN(odataReq)
    case DATA_READ_HANDLER:
      return readToCQN(service, target, odataReq)
    case DATA_UPDATE_HANDLER:
      return updateToCQN(data, odataReq)
    case 'BOUND.ACTION':
    case 'BOUND.FUNCTION':
      return boundToCQN(odataReq)
    default:
      return {}
  }
}
