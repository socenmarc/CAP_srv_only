const { generateKeyPath, splitByAndGetValueByIndex } = require('./utils')

const insert = (cqn, target, type) => {
  const url = generateKeyPath(cqn.INSERT.into, type, cqn.INSERT._transitions)

  if (cqn.INSERT.rows || cqn.INSERT.values) {
    throw new Error('Feature not supported: INSERT statement with .values or .rows')
  }

  const body =
    Array.isArray(cqn.INSERT.entries) && cqn.INSERT.entries.length === 1 ? cqn.INSERT.entries[0] : cqn.INSERT.entries

  return {
    path: `${splitByAndGetValueByIndex(url.path)}`,
    method: 'POST',
    body
  }
}

module.exports = insert
