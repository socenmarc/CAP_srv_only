const { generateKeyPath, generateKeysOfWhere, splitByAndGetValueByIndex } = require('./utils')

const deleet = (cqn, target, type) => {
  const url = generateKeyPath(cqn.DELETE.from, type, cqn.DELETE._transitions)

  if (cqn.DELETE.where) {
    if (url.keys) {
      throw new Error('Cannot generate URL for DELETE CQN. Conflicting .from and .where')
    }
    url.keys = `${type === 'rest' ? '/' : ''}${generateKeysOfWhere(cqn.DELETE.where, type, target)}`
  }

  return {
    path: `${splitByAndGetValueByIndex(url.path)}${url.keys || ''}`,
    method: 'DELETE'
  }
}

module.exports = deleet
