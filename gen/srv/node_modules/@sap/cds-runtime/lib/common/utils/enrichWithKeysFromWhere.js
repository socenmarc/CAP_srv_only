const enrichDataWithKeysFromWhere = (data, query, target) => {
  if (query.UPDATE && query.UPDATE.where) {
    const whereLength = query.UPDATE.where.length
    for (let i = 0; i < whereLength; i++) {
      const whereEl = query.UPDATE.where[i]
      const colName = whereEl.ref && whereEl.ref[whereEl.ref.length - 1]
      const colEl = colName && target.elements[colName]
      if (colEl && colEl.key) {
        const opWhere = query.UPDATE.where[i + 1]
        const valWhere = query.UPDATE.where[i + 2]
        if (opWhere === '=' && valWhere && 'val' in valWhere) {
          data[colName] = valWhere.val
        }
      }
    }
  }
}

module.exports = enrichDataWithKeysFromWhere
